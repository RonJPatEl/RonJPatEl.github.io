<html>

<head>

<!-- use the zotero API in future
https://www.zotero.org/support/dev/web_api/v3/basics#search_syntax -->
  
  <!-- zotero API user key = 6167652 
  <!-- https://zotero.org/users/6167652
  <!-- mypublications: https://api.zotero.org/users/6167652/publications/items -->
  
<!-- script: 
https://citeproc-js.readthedocs.io/en/latest/deployments.html
1. get csljson from zotero api e.g. https://api.zotero.org/users/6167652/publications/items?v=3&format=csljson
2. probabaly divide up by item-type, e.d. https://api.zotero.org/users/6167652/publications/items?v=3&format=csljson&itemType=journalArticle
2. parse csljson using citeproc-js

var chosenLibraryItems = "https://api.zotero.org/users/6167652/publications/items?v=3&format=csljson&itemType=journalArticle"
var chosenStyleID = "apa";

var xhr = new XMLHttpRequest();
xhr.open('GET', chosenLibraryItems, false);
xhr.send(null);
var citationData = JSON.parse(xhr.responseText);

var citations = {};
var itemIDs = [];
for (var i=0,ilen=citationData.items.length;i<ilen;i++) {
  var item = citationData.items[i];
  if (!item.issued) continue;
  if (item.URL) delete item.URL;
  var id = item.id;
  citations[id] = item;
  itemIDs.push(id);
}

citeprocSys = {
  retrieveLocale: function (lang){
    var xhr = new XMLHttpRequest();
    xhr.open('GET', 'https://raw.githubusercontent.com/Juris-M/citeproc-js-docs/master/locales-' + lang + '.xml', false);
    xhr.send(null);
    return xhr.responseText;
  },
  retrieveItem: function(id){
    return citations[id];
  }
};

function getProcessor(styleID) {
  var xhr = new XMLHttpRequest();
  xhr.open('GET', 'https://raw.githubusercontent.com/citation-style-language/styles/master/' + styleID + '.csl', false);
  xhr.send(null);
  var styleAsText = xhr.responseText;
  var citeproc = new CSL.Engine(citeprocSys, styleAsText);
  return citeproc;
};

function processorOutput() {
  ret = '';
  var citeproc = getProcessor(chosenStyleID);
  citeproc.updateItems(itemIDs);
  var result = citeproc.makeBibliography();
  return result[1].join('\n');
}

-->
  
<!-- add css -->
<link rel="stylesheet" href="/css/bootstrap.css">
<!-- old
<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/pcooksey/bibtex-js@1.0.0/src/bibtex_js.js"></script>
-->
<!--

-->
<script type="text/javascript" src="/src/bibtex_js.js"></script>
  
</head>

<body>

<h1> hier zou javascript output moeten komen </h1>

<bibtex src="ExportedItems.bib"></bibtex>

  <!--
<textarea id="bibtex_input" style="display:none;">
@article{pat2013validation,
  title={Validation of assessment for learning questionnaires for teachers and students},
  author={Pat-El, Ron Jonathan and Tillema, Harm and Segers, Mien and Vedder, Paul},
  journal={British Journal of Educational Psychology},
  volume={83},
  number={1},
  pages={98--113},
  year={2013},
  publisher={Wiley Online Library},
  url={https://onlinelibrary.wiley.com/doi/full/10.1111/j.2044-8279.2011.02057.x?casa_token=RdEcg8kRkHwAAAAA%3AaNfiGmVDEp0Hq9DJptP02XdMc2IQR138VCEUlDyhNe6J2P0NcPFw7tHO_f0Jr6T7uWI_KGo6Vy2lv5Et}
}
</textarea>
-->

  <!--
<div id="bibtex_display"></div>
-->

  <!--
  <div id="bibtex_display">

  <div class="bibtex_template">
    <ul> <li>
      <span class="if title">
        <a class="url">
            <span class="title"></span>,
        </a>
      </span>
      <div class="if author">
        <span class="author"></span>
      </div>
      <div>
        <span class="if journal"><em><span class="journal"></span></em></span>
        <span class="if month"><span class="month"></span>,</span>
        <span class="if year"><span class="year"></span>.</span>
      </div>
    </li></ul>
  </div>

</div>
-->
<div id="bibtex_display">  
  <div class="bibtex_structure">
  <div class="sections bibtextypekey">
    <div class="section article">
      <h1>Refereed Articles</h1>
      <div class="sort year" extra="DESC number">
        <div class="templates"></div>
      </div>
    </div>
    <div class="section book">
      <h1>Books</h1>
      <div class="sort year" extra="ASC number">
        <div class="templates"></div>
      </div>
    </div>
    <div class="section inproceedings">
      <h1>Conference and Workshop Papers</h1>
      <div class="sort year" extra="ASC number">
        <div class="templates"></div>
      </div>
    </div>
    <div class="section misc|phdthesis|mastersthesis|bachelorsthesis|techreport">
      <h1>Other Publications</h1>
      <div class="sort year" extra="ASC number">
        <div class="templates"></div>
      </div>
    </div>
  </div>
</div>

</div>
  
</body>

</html>
